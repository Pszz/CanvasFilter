const _filters={invert:function(context,data,c){let dd=data.data,len=c.height*c.width*4;for(let i=0;i<len;i+=4){let r=dd[i],g=dd[i+1],b=dd[i+2];dd[i]=255-r,dd[i+1]=255-g,dd[i+2]=255-b}},gray:function(context,data,c){let dd=data.data,len=c.height*c.width*4;for(let i=0;i<len;i+=4){let r,g,b,cl=.299*dd[i]+.587*dd[i+1]+.114*dd[i+2];dd[i]=dd[i+1]=dd[i+2]=cl}},blur:function(context,data){let temp=_copyLayer(context,data),red=0,green=0,blue=0;for(let x=0;x<temp.width;x++)for(let y=0;y<temp.height;y++){let idx=4*(x+y*temp.width);for(let subCol=-2;subCol<=2;subCol++){let colOff=subCol+x;(colOff<0||colOff>=temp.width)&&(colOff=0);for(let subRow=-2;subRow<=2;subRow++){let rowOff=subRow+y;(rowOff<0||rowOff>=temp.height)&&(rowOff=0);let idx2=4*(colOff+rowOff*temp.width),r,g,b;red+=temp.data[idx2+0],green+=temp.data[idx2+1],blue+=temp.data[idx2+2]}}data.data[idx+0]=red/25,data.data[idx+1]=green/25,data.data[idx+2]=blue/25,data.data[idx+3]=255,red=green=blue=0}},relief:function(context,data){let temp=_copyLayer(context,data),h=temp.height,w=temp.width;for(let x=1;x<w-1;x++)for(let y=1;y<h-1;y++){let idx=4*(x+y*w),bidx=4*(x-1+y*w),aidx=4*(x+1+y*w),nr=temp.data[aidx+0]-temp.data[bidx+0]+128,ng=temp.data[aidx+1]-temp.data[bidx+1]+128,nb=temp.data[aidx+2]-temp.data[bidx+2]+128;nr=nr<0?0:nr>255?255:nr,ng=ng<0?0:ng>255?255:ng,nb=nb<0?0:nb>255?255:nb,data.data[idx+0]=nr,data.data[idx+1]=ng,data.data[idx+2]=nb,data.data[idx+3]=255}},sculpture:function(context,data){let temp=_copyLayer(context,data),h=temp.height,w=temp.width;for(let x=1;x<w-1;x++)for(let y=1;y<h-1;y++){let idx=4*(x+y*w),bidx=4*(x-1+y*w),aidx=4*(x+1+y*w),nr=temp.data[bidx+0]-temp.data[aidx+0]+128,ng=temp.data[bidx+1]-temp.data[aidx+1]+128,nb=temp.data[bidx+2]-temp.data[aidx+2]+128;nr=nr<0?0:nr>255?255:nr,ng=ng<0?0:ng>255?255:ng,nb=nb<0?0:nb>255?255:nb,data.data[idx+0]=nr,data.data[idx+1]=ng,data.data[idx+2]=nb,data.data[idx+3]=255}},mirror:function(context,data){let temp=_copyLayer(context,data);for(let x=0;x<temp.width;x++)for(let y=0;y<temp.height;y++){let idx=4*(x+y*temp.width),midx=4*(temp.width-1-x+y*temp.width);data.data[midx+0]=temp.data[idx+0],data.data[midx+1]=temp.data[idx+1],data.data[midx+2]=temp.data[idx+2],data.data[midx+3]=255}},baw:function(context,data){let temp=_copyLayer(context,data),color=0;for(let x=0;x<temp.width;x++)for(let y=0;y<temp.height;y++){let idx=4*(x+y*temp.width),nr,ng,nb,avg;color=(temp.data[idx+0]+temp.data[idx+1]+temp.data[idx+2])/3>=128?255:0,data.data[idx+0]=color,data.data[idx+1]=color,data.data[idx+2]=color,data.data[idx+3]=255}}},_copyLayer=function(context,src){let img=context.createImageData(src.width,src.height);return img.data.set(src.data),img},_MSIE=function(){let appName=navigator.appName,appVer,version,verTrim=navigator.appVersion.split(";")[1].replace(/[ ]/g,"");return"Microsoft Internet Explorer"===appName&&("MSIE6.0"===verTrim?6:"MSIE7.0"===verTrim?7:"MSIE8.0"===verTrim?8:"MSIE9.0"===verTrim?9:10)}(),API={_canvas:null,init(ele,img){let canvas=document.createElement("canvas"),context=canvas.getContext("2d");return ele?img?canvas.getContext?_MSIE&&_MSIE<10?"Please upgrade your browser":img.clientWidth&&img.clientHeight?(canvas.width=img.clientWidth,canvas.height=img.clientHeight,context.drawImage(img,0,0,canvas.width,canvas.height),ele.innerHTML="",ele.appendChild(canvas),this._canvas=canvas,!0):"ImageElement Uninitialized":"Please check if your browser supports canvas":"Need to pass in a img element":"Need to pass in a parent element"},filter(type,ele,img){return new Promise((resolve,reject)=>{let check=this.init(ele,img);if(!0!==check)throw console.error(check),new Error(check);let cvs=this._canvas,context=cvs.getContext("2d"),canvasData=context.getImageData(0,0,cvs.width,cvs.height);cvs?(type&&(_filters[type]&&_filters[type](context,canvasData,cvs),context.putImageData(canvasData,0,0)),resolve()):reject("Uninitialized")})}};export default API;